#### WIL NODE WITH BOOK

> WEEK's KEY WORD

- 런타임, 이벤트 기반, 논 블로킹 I/O, 싱글 스레드 모델

> SUMMARY

1.1 Node.js?

- Chrome V8 Javascript 엔진으로 빌드된 Javascript 런타임입니다.
- 노드로 `서버`를 실행할 수 도 있지만 서버 외의 자바스크립트 프로그램을 실행하는 `런타임`으로서 사용할 수 도 있다.

  1.1.1 서버?

- 네트워크를 통해 클라이언트에 정보나 서비스를 제공하는 컴퓨터 또는 프로그램
- 클라이언트? 요청을 보내는 주체로 브라우저, 데스크톱 프로그램, 모바일 앱, 다른 서버에 요청을 보내는 서버

데이터를 어딘가에 저장하고, 그 어딘가에서 클라이언트로 데이터를 받아와야 하는 곳이 바로 서버이다.
=> 서버는 클라이언트의 요청에 대해 응답을 하는 역할을한다
=> 노드는 자바스크립트 프로그램이 서버로서 기능하기 위한 도구를 제공하므로 `서버` 역할을 수행할 수 있다.

1.1.2 노드의 특성?
1> 자바스크립트 런타임 2> 이벤트 기반 3> 1.1.4 논 블로킹 I/O 4> 싱글 스레드

1.1.2 자바스크립트 런타임

- 노드는 자바스크립트 런타임이다.
- 런타임? 특정 언어로 만든 프로그램들을 실행할 수 있는 환경
- 따라서 노드를 통해 자바스크립트 프로그램을 컴퓨터에서 실행할 수 있다. (노드=자바스크립트 실행기)

노드의 구조

- 노드는 `V8`과 더불어 `libuv`라는 라이브러리를 사용되어 구축되었다.
- libuv 라이브러리는 노드의 특성인 `이벤트 기반`, `논 블로킹 I/O 모델`을 구현합니다.

  1.1.3 이벤트 기반

- 이벤트 기반(event-driven)? 이벤트가 발생할 때 미리 지정해둔 작업을 수행하는 방식을 의미한다.
  > 이벤트 기반 동작 과정
- 노드는 이벤트 기반 방식으로 동작하므로, 1> 이벤트 리스너에 등록하고 2> 이벤트가 발생하면 이벤트 리스너에 등록해둔 콜백 콜백 함수를 호출한 뒤 3> 발생한 이벤트가 없거나 발생했던 이벤트를 다 처리하면, 노드는 다음 이벤트가 발생할 때까지 대기하는 과정을 거친다. 4> 이벤트 루프는 호출 스택이 비어 있으면 태스크 큐에서 함수를 가져와 호출 스택에 넣고 실행한다.

- 이벤트 기반 모델에는 `이벤트 루프(event loop)`라는 개념이 전제된다.
  `이벤트 루프(event loop)`란 여러 이벤트가 동시에 발생했을 때 어떤 순서로 콜백 함수를 호출할지를 판단해주는 역할을 한다.
  > • 이벤트 루프: 이벤트 발생 시 호출할 콜백 함수들을 관리하고, 호출된 콜백 함수의 실행 순서를 결정하는 역할을 담당
  > 노드가 종료될 때까지 이벤트 처리를 위한 작업을 반복하므로 루프(loop)라고 부른다.
  > • 백그라운드: setTimeout 같은 타이머나 이벤트 리스너들이 대기하는 곳으로 자바스크립트가 아닌 다른 언어로 작성된 프로그램이다. 여러 작업이 동시에 실행될 수 있다.
  > • 태스크 큐: 이벤트 발생 후, 백그라운드에서는 태스크 큐로 타이머나 이벤트 리스너의 콜백 함수를 보낸다. 정해진 순서대로 콜백들이 줄을 서 있으므로 콜백 큐라고도 한다.
  > 콜백들은 보통 완료된 순서대로 줄을 서 있지만 특정한 경우에는 순서가 바뀌기도 합니다.

-노드는 자바스크립트 코드의 위부터 한 줄씩 실행하며 1> 함수 호출 부분을 발견했다면 2> 호출한 함수를 호출 스택(call stack)에 넣고 함수는 실행되는 동안 호출 스택에 머물러 있다가 3> 실행이 완료되면 호출 스택에서 지워진다. 4> anonymous 컨텍스트까지 실행이 모두 완료되었다면 호출 스택은 비어 있게 된다.ㄴ
-anonymous 함수는 처음 실행 시의 `전역 컨텍스트(global context)`이다. -전역 컨텍스트(global context)? 전역 함수가 호출되었을 때 생성되는 환경을 의미을 한다

1.1.4 논 블로킹 I/O

- 이벤트 루프를 활용하면 오래 걸리는 작업을 효율적으로 처리 가능하고 이 작업에는 두 가지 종류로 1> 동시에 실행될 수 있는 작업과 2> 동시에 실행될 수 없는 작업입니다.
- 기본적으로 자바스크립트 코드는 동시에 실행될 수 없지만 자바스크립트상에서 돌아가는 것이 아닌 I/O 작업 같은 것은 동시에 처리될 수 있다. -`I/O`? 입력(Input)/출력(Output)을 의미하여 파일 시스템 접근(파일 읽기, 파일 쓰기, 폴더 만들기 등)이나 네트워크를 통한 요청 같은 작업을 말한다.
- 노드는 논 블로킹 방식으로 처리하는 방법을 제공하는데
  1> `논 블로킹`이란 이전 작업이 완료될 때까지 대기하지 않고 다음 작업을 수행함을 뜻하며. 2> 반대로 `블로킹`은 이전 작업이 끝나야만 다음 작업을 수행하는 것을 의미합니다.
  => 이렇게 노드는 I/O 작업을 백그라운드로 넘겨 동시에 처리하곤 한다

주의 ) `논 블로킹`과 `동시`는 같은 의미가 아니다. `동시성`? 동시 처리가 가능한 작업을 논 블로킹 처리해야 얻을 수 있는 것을 의미한다.

1.1.5 싱글 스레드

- 싱글 스레드란 스레드가 하나뿐이라는 것을 의미한다. 이는 작성한 자바스크립트 코드가 동시에 실행될 수 없는 이유이기도 하다.
  . 프로세스와 스레드의 차이?

  - • 프로세스? 운영체제에서 할당하는 작업의 단위로 노드나 웹 브라우저 같은 프로그램은 개별적인 프로세스로 취급된다. 프로세스 간에는 메모리 등의 자원을 공유하지 않는다.
  - • 스레드? 프로세스 내에서 실행되는 흐름의 단위로 프로세스는 스레드를 여러 개 생성해 여러 작업을 동시에 처리할 수 있다.
    스레드들은 부모 프로세스의 자원을 공유하고 같은 주소의 메모리에 접근 가능하므로 데이터를 공유할 수도 있다.

  노드는 `싱글 스레드`이지만 엄밀히 말하면 싱글 스레드로 동작하지는 않는다.
  1> 노드를 실행하면 먼저 프로세스가 하나 생성됩니다. 그리고 그 프로세스에서 스레드들을 생성하는데, 2> 이떄 내부적으로 스레드를 여러 개 생성하는데 그중에서 직접 제어할 수 있는 스레드는 오직 하나뿐이기 때문에 노드를 싱글 스레드라 부른다.

참고 ) 레드풀과 워커 스레드
노드가 싱글 스레드로 동작하지 않는 두 가지 경우 1> 스레드풀(Thread Pool) 2> 워커 스레드(Worker Thread)이다.
1>`스레드풀`은 노드가 특정 동작을 수행할 때 스스로 멀티 스레드를 사용한다. EX> 암호화(3.5.5절), 파일 입출력(3.6절), 압축(3.6.2절) 등.
2>`워커 스레드` 노드 12 버전에서 안정화된 기능으로 노드에서도 멀티 스레드를 사용할 수 있게 되어 다수의 스레드를 다룰 수 있게 됨을 의미한다. CPU 작업(연산이 많은 작업)이 많은 경우 워커 스레드를 사용한다.

노드가 채택하고 있는 방식은 싱글 스레드, 논 블로킹 모델로 장점으로는 예를들어 식당에서 점원은 한 명이지만 혼자서 많은 일을 처리할 수 있습니다.
단점은 점원 한 명이 아파서 쓰러지거나 하면 큰 문제가 생기고 요리를 하는 데 시간이 오래 걸린다면(CPU를 많이 쓰는 작업) 주문이 많이 들어왔을 때 버거울 수 있다
VS
멀티 스레드 방식에서는 손님 한 명이 올 때마다 점원도 한 명씩 붙어 주문을 받고 서빙합니다. 장점으로 일단 손님 한 명당 점원도 한 명이면 서빙 자체는 걱정이 없습니다. 점원 한 명에게 문제가 생겨도 다른 점원으로 대체 가능하지만 단점은 손님의 수가 늘어날수록 점원의 수도 늘어납니다. 손님 수가 줄어들었을 때 일을 하지 않고 노는 점원이 있다는 것도 문제가 됩니다. 점원을 새로 고용하거나 기존 점원을 해고하는 데는 비용이 발생한다.

멀티 스레딩 VS 멀티 프로세싱
멀티 스레딩? 1. 하나의 프로세스 안에서 여러 개의 스레드 사용 2. CPU 작업이 많을 때 사용 3. 프로그래밍이 어려움
멀티 프로세싱? 1. 여러 개의 프로세스 사용 2.I/O 요청이 많을 때 사용 3.프로그래밍이 비교적 쉬움

따라서 I/O 작업을 처리할 때는 멀티 스레딩보다 멀티 프로세싱이 효율적으로 노드는 멀티 프로세싱을 많이 합니다.

`실행 컨텍스트`

실행될 수 있는 환경

=> 하위개념 / 변수, 스코프, this, 함수 선언
